# Adguard
upstream                      adguard {
    server                    prd-adguard-home-app:3000;
  }

server {
    listen                    80;
    server_name               adguard.docker;
    server_tokens             off;
    
    location / {
      proxy_pass              http://adguard;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# DSMR-Reader
upstream                      dsmrreader {
    server                    prd-dsmr-reader-app:80;
}

server {
    listen                    80;
    server_name               dsmrreader.docker;
    server_tokens             off;

    location / {
      proxy_pass              http://dsmrreader;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# ESPhome
upstream                      esphome {
    server                    docker.stam.lan:6052;
}

server {
    listen                    80;
    server_name               esphome.docker;
    server_tokens             off;
    
    location / {
      proxy_pass              http://esphome;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Home Assistant
upstream                      homeassistant {
    server                    docker.stam.lan:8123;
}

server {
    listen                    80;
    server_name               homeassistant.docker;
    server_tokens             off;
    
    location / {
      proxy_pass              http://homeassistant;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Omada Controller
upstream                      omada {
    server                    docker.stam.lan:8043;
}

server {
    listen                    80;
    server_name               omada.docker;
    server_tokens             off;
    
    location / {
      proxy_pass              http://omada;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Plex
upstream                      plex {
    server                    prd-plex-app:32400;
}

server {
    listen                    80;
    server_name               plex.docker;
    server_tokens             off;

    location / {
      proxy_pass              http://plex;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Transmission
upstream                      transmission {
    server                    prd-transmission-openvpn-app:9091;
}

server {
    listen                    80;
    server_name               transmission.docker;
    server_tokens             off;
  
    location / {
      proxy_pass              http://transmission;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# ZwaveJS2MQTT
upstream                      zwave {
    server                    prd-zwavejs2mqtt-app:8091;
}

server {
    listen                    80;
    server_name               zwave.docker;
    server_tokens             off;
  
    location / {
      proxy_pass              http://zwave;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Node-RED
upstream                      nodered {
    server                    prd-node-red-app:1880;
}

server {
    listen                    80;
    server_name               nodered.docker;
    server_tokens             off;
    
    location / {
      proxy_pass              http://nodered;
      proxy_set_header        Host                $http_host;
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $server_name;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}

# Portainer
upstream                      portainer {
    server                    prd-portainer-app:9000;
}

server {
    listen                    80;
    server_name               portainer.docker;
    server_tokens             off;
  
    location / {
      proxy_pass              http://portainer;
      proxy_set_header        Host                $host;
      proxy_redirect          off; 
      proxy_set_header        X-Real-IP           $remote_addr;
      proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
      proxy_set_header        X-Forwarded-Proto   $scheme;
      proxy_set_header        X-Forwarded-Host    $host;
      proxy_set_header        X-Forwarded-Port    $server_port;
      proxy_set_header        Upgrade             $http_upgrade;
      proxy_set_header        Connection          "Upgrade";
  }
}
